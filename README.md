# They Are Billions アラートバグ対策ツール
They Are Billionsのアラートバグ対策ツール。ミニマップを監視し、攻撃を検知した場合アラート用の音源を再生します。
  
  
# ファイルの説明
|ファイル名|説明|
----|---- 
|tab.ini|設定ファイル|
|tab.py|アラートバグ対策ツール|
|tab.exe|tab.py を pyinstaller で exe 化したもの|
|CreateDatePicture.py|アラートバグ対策開始日付と終了日付用ファイルを作成する|
|CreateDatePicture.exe|CreateDatePicture.py を pyinstaller で exe 化したもの|
|start.wav|アラートバグ対策開始メッセージファイル|
|end.wav|アラートバグ対策終了メッセージファイル|
  
  
# 設定

## tab.iniの編集
tab.iniをメモ帳等のエディタで開きます。

name 項目は編集の必要はありません。

alert 項目はアラート用の音源ファイル名になります。 wav ファイルを利用する等ファイル名を変える必要がある
場合は変更してください。**日本語ファイル名は利用できません、ツールが落ちます**。

## アラート用ファイルの配置
フリー素材等からアラートに用いるファイルをダウンロードし tab.py 、 tab.exe 、 tab.ini と同じフォルダに配置します。
ファイル名は tab.ini の alert 項目に設定したファイル名とします。
アラート用ファイルは再生時間の短いものを推奨します。

### python.pyを利用する場合
pythonをインストールします。開発環境は 3.9.7 を利用しました。

以下のpipコマンドでライブラリをインストールします  
pip install cv2  
pip install numpy  
pip install pyws  
pip install pywin32  
pip install playsound==1.2.2  
pip install configparser  
pip install threading
pip install wxPython

各ライブラリの用途は以下の通りです。
|ライブラリ|用途|
----|---- 
|cv2|画像処理|
|numpy|cv2での画像格納|
|pyws|window id 扱うため|
|pywin32|win32guiを利用するため|
|playsound|wav,mp3を再生するため。最新版（1.3.0）だとファイルロード時に落ちた|
|configparser|iniファイルの読み込み|
|threading|スレッドを利用するため|
|wxPython|画面表示をするため|

### アラートバグ対策開始日付と終了日付用ファイルの作成
They Are Billions で0日目とアラートバグ対策を止めたい日（例：20日目）の画面をキャプチャをし、pngファイルで保存します。
ファイルがない場合アラートバグ対策を止めません。

#### exeファイルを利用する場合
コマンドプロンプトでCreateDatePicture.exeの存在するフォルダに移動後、以下のコマンドでファイルを作成します。
> CreateDatePicture.exe 0日目のキャプチャファイル名 アラートバグ対策を止めたい日のキャプチャファイル名

#### python スクリプトを利用する場合
コマンドプロンプトでCreateDatePicture.pyの存在するフォルダに移動します。
以下のコマンドでファイルを作成します。
> python CreateDatePicture.py 0日目のキャプチャファイル名 アラートバグ対策を止めたい日のキャプチャファイル名

start_date.png, end_date.pngの2ファイルが作成されます。
作成されたファイルをtab.py 、 tab.exe 、 tab.ini と同じフォルダに配置します。

## アラートバグ対策開始、終了メッセージ用ファイル配置
※ファイルがなくても動作に問題ありません。
start.wav 、 end.wav を tab.py 、 tab.exe 、 tab.ini と同じフォルダに配置します。
start.wav を開始時に、 end.wav を停止時に再生します。
  
  
# ツールの起動方法
起動は They Are Billions の起動前、起動中どちらでも構いません。

## exeファイルを利用する場合
tab.exeをダブルクリックするとコマンドプロンプトが立ち上がり起動します。
コマンドプロンプトでtab.exeの存在するフォルダに移動後、以下のコマンドでも起動します。
> tab.exe

## python スクリプトを利用する場合
tab.pyをダブルクリックするとコマンドプロンプトが立ち上がり起動します。
コマンドプロンプトでtab.pyの存在するフォルダに移動後、以下のコマンドでも起動します。
> python tab.py
  
  
# ツールの停止方法
コマンドプロンプトで「Ctrl c」で停止します。
停止は They Are Billions の起動中、停止後どちらでも構いません。
  
  
# 制限
- アラート用ファイルのファイル名に日本語ファイル名は利用できません
- アラート用ファイルは wav か mp3 に限ります
- エクスプローラーで「They Are Billions」という名前のフォルダを開いていると正常に動作しません
- ミニマップの白枠の白色部分は攻撃を検知できません
- 腐食の地以外のマップでは動作不良が起きる可能性があります。開発環境で試していません
- 1920x1080、フルスクリーン以外の環境で試していません
- 変異体、ジャイアントの攻撃検知は行われません
- アラートは They Are Billions のアラートと同時か一呼吸遅れます
- ウェーブの発生地点が変異体と重なるとアラートとして検知します
  
  
# 動作原理
画像のように攻撃を受けたとします。
![攻撃を受ける](/image/01.png)

ツールはミニマップを常に監視し、一瞬前のミニマップの緑（ユニットや建物）と現在の明るい赤（ダメージを受けたユニットや建物）を比較して攻撃を検知し、ミニマップ上に表示をし音源を再生します。
![動作原理](/image/02.png)

またミニマップ上に表示されるアラートを検知して、ミニマップ上に表示をし音源を再生します。